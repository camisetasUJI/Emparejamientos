<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CustomTee | Design Your Vibe</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
            --accent: #f43f5e;
            --bg: #f8fafc;
            --card-bg: #ffffff;
            --text-main: #0f172a;
            --text-soft: #4f46e5;
            --text-muted: #94a3b8;
            --border: #f1f5f9;
            --radius-xl: 32px;
            --radius-lg: 18px;
            --shadow-vibe: 0 25px 50px -12px rgba(99, 102, 241, 0.15);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background: var(--bg); 
            color: var(--text-main); 
            padding: 20px; 
            line-height: 1.5;
            background-image: 
                radial-gradient(at 0% 0%, rgba(99, 102, 241, 0.1) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(168, 85, 247, 0.1) 0px, transparent 50%);
        }

        .container { max-width: 850px; margin: 60px auto; }
        
        .header { text-align: center; margin-bottom: 60px; }
        .header h1 { 
            font-size: 4rem; 
            font-weight: 800; 
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.07em;
            margin-bottom: 15px;
        }
        .header p { color: var(--text-soft); font-weight: 700; font-size: 1.2rem; letter-spacing: -0.02em; }

        .card { 
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-xl); 
            box-shadow: var(--shadow-vibe); 
            padding: 60px; 
            border: 1px solid rgba(255, 255, 255, 0.4);
        }

        .section { margin-bottom: 60px; animation: fadeIn 0.8s ease-out both; }
        .section-title { 
            display: flex; 
            align-items: center; 
            gap: 15px; 
            margin-bottom: 35px; 
            font-size: 1.6rem; 
            font-weight: 800;
            letter-spacing: -0.04em;
        }

        .step-num {
            background: var(--primary-gradient);
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            box-shadow: 0 8px 15px rgba(99, 102, 241, 0.3);
        }

        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px; }
        @media (max-width: 640px) { .grid { grid-template-columns: 1fr; } .card { padding: 30px; } .header h1 { font-size: 3rem; } }

        .form-group { margin-bottom: 25px; }
        label { display: block; font-weight: 800; font-size: 0.8rem; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-muted); }

        input, select, textarea {
            width: 100%; padding: 18px; border: 2.5px solid var(--border); border-radius: var(--radius-lg);
            font-size: 1rem; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); font-family: inherit;
            background: #fff;
        }
        input:focus, select:focus, textarea:focus { 
            border-color: #6366f1; 
            box-shadow: 0 15px 30px rgba(99, 102, 241, 0.1); 
            outline: none; 
            transform: translateY(-3px);
        }

        /* PALETA DE COLORES */
        .color-group-tag {
            font-size: 0.7rem; font-weight: 900; color: #6366f1; text-transform: uppercase;
            letter-spacing: 0.15em; margin: 30px 0 15px; display: block;
            background: #eef2ff; width: fit-content; padding: 4px 12px; border-radius: 6px;
        }
        .color-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(85px, 1fr)); gap: 14px; }
        .color-item { position: relative; cursor: pointer; text-align: center; }
        .color-item input { position: absolute; opacity: 0; }
        .color-swatch { 
            width: 52px; height: 52px; border-radius: 18px; border: 4px solid #fff; 
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.08); display: block; margin: 0 auto 10px; 
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .color-item input:checked + .color-swatch { 
            transform: scale(1.25) rotate(10deg); 
            box-shadow: 0 20px 25px -5px rgba(99, 102, 241, 0.3); 
            border-color: #6366f1; 
        }
        .color-name { font-size: 0.65rem; font-weight: 800; color: var(--text-muted); text-transform: uppercase; display: block; line-height: 1.2; }

        /* Tallas */
        .size-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(90px, 1fr)); gap: 15px; }
        .size-box { background: #f8fafc; padding: 20px; border-radius: var(--radius-lg); text-align: center; border: 2.5px solid transparent; transition: 0.3s; }
        .size-box span { font-weight: 900; font-size: 1rem; color: var(--text-main); }
        .size-box input { padding: 10px; margin-top: 10px; border: none; background: transparent; font-weight: 800; text-align: center; font-size: 1.2rem; color: #6366f1; width: 60px; }

        /* CARGA DE ARCHIVOS */
        .drop-zone {
            border: 3px dashed #e2e8f0; 
            border-radius: var(--radius-lg); 
            padding: 50px 30px;
            text-align: center; 
            background: #fcfcfc; 
            cursor: pointer; 
            transition: all 0.4s ease;
            position: relative;
        }
        .drop-zone.dragover { border-color: #6366f1; background: #f5f3ff; transform: scale(1.02); }
        .drop-zone input { position: absolute; inset: 0; opacity: 0; cursor: pointer; z-index: 10; }
        .drop-icon { font-size: 3.5rem; display: block; margin-bottom: 15px; }
        
        .file-counter {
            display: inline-block;
            margin-top: 15px;
            background: var(--primary-gradient);
            color: white;
            padding: 6px 16px;
            border-radius: 100px;
            font-size: 0.85rem;
            font-weight: 800;
            opacity: 0;
            transition: 0.3s;
        }
        .file-counter.visible { opacity: 1; }

        .preview-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); 
            gap: 15px; 
            margin-top: 30px; 
        }
        .preview-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            border: 3px solid white;
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) both;
        }
        .preview-img { width: 100%; height: 100%; object-fit: cover; }
        
        .remove-file {
            position: absolute;
            top: 5px;
            right: 5px;
            background: var(--accent);
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 20;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        @keyframes popIn { from { opacity: 0; transform: scale(0.5); } to { opacity: 1; transform: scale(1); } }

        /* Footer */
        .footer-summary {
            position: sticky; bottom: 30px; background: #0f172a; color: white;
            padding: 25px 40px; border-radius: 100px; display: flex; justify-content: space-between;
            align-items: center; margin-top: 50px; box-shadow: 0 30px 60px -12px rgba(0,0,0,0.4);
            z-index: 100;
        }
        .total-amount { font-size: 2.2rem; font-weight: 900; color: #a855f7; }

        .btn-send {
            width: 100%; background: var(--primary-gradient); color: white; border: none; padding: 25px;
            border-radius: var(--radius-lg); font-size: 1.5rem; font-weight: 800; cursor: pointer;
            transition: 0.4s; margin-top: 40px; 
            box-shadow: 0 15px 35px rgba(99, 102, 241, 0.4);
        }
        .btn-send:hover:not(:disabled) { transform: translateY(-6px) scale(1.02); box-shadow: 0 25px 50px rgba(99, 102, 241, 0.5); }
        .btn-send:disabled { opacity: 0.6; cursor: not-allowed; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(40px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="container">
        <header class="header">
            <h1>CustomTee</h1>
            <p>Dise√±o salvaje. Calidad de locos.</p>
        </header>

        <!-- FormSubmit endpoint con tu email -->
        <form id="mainForm" action="https://formsubmit.co/malasanapedro@gmail.com" method="POST" enctype="multipart/form-data">
            
            <input type="hidden" name="_subject" value="üî• NUEVO PEDIDO TOP - CustomTee">
            <input type="hidden" name="_template" value="table">
            <input type="hidden" name="_captcha" value="false">

            <div class="card">
                <!-- 01: Identidad -->
                <div class="section">
                    <div class="section-title"><div class="step-num">1</div> Identidad</div>
                    <div class="grid">
                        <div class="form-group">
                            <label>Carrera Universitaria</label>
                            <input type="text" name="Carrera" placeholder="Ej: Facultad de Medicina" required>
                        </div>
                        <div class="form-group">
                            <label>Responsable</label>
                            <input type="text" name="Responsable" placeholder="¬øA qui√©n buscamos?" required>
                        </div>
                        <div class="form-group" style="grid-column: span 2">
                            <label>WhatsApp Directo</label>
                            <input type="tel" name="WhatsApp" placeholder="+34 600 000 000" required>
                        </div>
                    </div>
                </div>

                <!-- 02: Color de la prenda -->
                <div class="section">
                    <div class="section-title"><div class="step-num">2</div> Color de la prenda</div>
                    
                    <span class="color-group-tag">Los Imprescindibles</span>
                    <div class="color-grid">
                        <label class="color-item"><input type="radio" name="Color_Prenda" value="Blanco" checked><span class="color-swatch" style="background:#ffffff"></span><span class="color-name">Blanco</span></label>
                        <label class="color-item"><input type="radio" name="Color_Prenda" value="Negro"><span class="color-swatch" style="background:#000000"></span><span class="color-name">Negro</span></label>
                        <label class="color-item"><input type="radio" name="Color_Prenda" value="Gris Melange"><span class="color-swatch" style="background:#d1d5db"></span><span class="color-name">Gris Melange</span></label>
                        <label class="color-item"><input type="radio" name="Color_Prenda" value="Antracita"><span class="color-swatch" style="background:#334155"></span><span class="color-name">Antracita</span></label>
                    </div>

                    <span class="color-group-tag">Gama de Azules</span>
                    <div class="color-grid">
                        <label class="color-item"><input type="radio" name="Color_Prenda" value="Marino"><span class="color-swatch" style="background:#1e3a8a"></span><span class="color-name">Marino</span></label>
                        <label class="color-item"><input type="radio" name="Color_Prenda" value="Royal"><span class="color-swatch" style="background:#2563eb"></span><span class="color-name">Royal</span></label>
                        <label class="color-item"><input type="radio" name="Color_Prenda" value="Celeste"><span class="color-swatch" style="background:#bae6fd"></span><span class="color-name">Celeste</span></label>
                        <label class="color-item"><input type="radio" name="Color_Prenda" value="Sky Blue"><span class="color-swatch" style="background:#7dd3fc"></span><span class="color-name">Sky Blue</span></label>
                    </div>

                    <span class="color-group-tag">Rojos y Rosas</span>
                    <div class="color-grid">
                        <label class="color-item"><input type="radio" name="Color_Prenda" value="Rojo"><span class="color-swatch" style="background:#dc2626"></span><span class="color-name">Rojo</span></label>
                        <label class="color-item"><input type="radio" name="Color_Prenda" value="Granate"><span class="color-swatch" style="background:#991b1b"></span><span class="color-name">Granate</span></label>
                        <label class="color-item"><input type="radio" name="Color_Prenda" value="Burdeos"><span class="color-swatch" style="background:#7f1d1d"></span><span class="color-name">Burdeos</span></label>
                        <label class="color-item"><input type="radio" name="Color_Prenda" value="Rosa Claro"><span class="color-swatch" style="background:#fbcfe8"></span><span class="color-name">Rosa Pale</span></label>
                    </div>

                    <span class="color-group-tag">Verdes y Tierras</span>
                    <div class="color-grid">
                        <label class="color-item"><input type="radio" name="Color_Prenda" value="Botella"><span class="color-swatch" style="background:#064e3b"></span><span class="color-name">V. Botella</span></label>
                        <label class="color-item"><input type="radio" name="Color_Prenda" value="Kelly"><span class="color-swatch" style="background:#16a34a"></span><span class="color-name">V. Kelly</span></label>
                        <label class="color-item"><input type="radio" name="Color_Prenda" value="Arena"><span class="color-swatch" style="background:#e7e5e4"></span><span class="color-name">Arena</span></label>
                        <label class="color-item"><input type="radio" name="Color_Prenda" value="Chocolate"><span class="color-swatch" style="background:#451a03"></span><span class="color-name">Chocolate</span></label>
                    </div>

                    <span class="color-group-tag">Especiales</span>
                    <div class="color-grid">
                        <label class="color-item"><input type="radio" name="Color_Prenda" value="Morado"><span class="color-swatch" style="background:#6d28d9"></span><span class="color-name">Morado</span></label>
                        <label class="color-item"><input type="radio" name="Color_Prenda" value="Berenjena"><span class="color-swatch" style="background:#4c1d95"></span><span class="color-name">Berenjena</span></label>
                        <label class="color-item"><input type="radio" name="Color_Prenda" value="Oro"><span class="color-swatch" style="background:#fbbf24"></span><span class="color-name">Oro</span></label>
                    </div>
                </div>

                <!-- 03: Tallas -->
                <div class="section">
                    <div class="section-title"><div class="step-num">3</div> Tallas</div>
                    <div class="size-grid">
                        <div class="size-box"><span>XS</span><input type="number" name="XS" value="0" min="0" class="qty-in"></div>
                        <div class="size-box"><span>S</span><input type="number" name="S" value="0" min="0" class="qty-in"></div>
                        <div class="size-box"><span>M</span><input type="number" name="M" value="0" min="0" class="qty-in"></div>
                        <div class="size-box"><span>L</span><input type="number" name="L" value="0" min="0" class="qty-in"></div>
                        <div class="size-box"><span>XL</span><input type="number" name="XL" value="0" min="0" class="qty-in"></div>
                        <div class="size-box"><span>XXL</span><input type="number" name="XXL" value="0" min="0" class="qty-in"></div>
                    </div>
                </div>

                <!-- 04: Personalizaci√≥n -->
                <div class="section">
                    <div class="section-title"><div class="step-num">4</div> Personalizaci√≥n</div>
                    <div class="grid">
                        <div class="form-group">
                            <label>Zona de Estampado</label>
                            <select name="Ubicacion">
                                <option value="Pecho">Pecho Izquierdo (Mini)</option>
                                <option value="Centro">Pecho Central (Grande)</option>
                                <option value="Espalda">Espalda Completa</option>
                                <option value="Mangas">Mangas</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Color del Dise√±o</label>
                            <input type="text" name="Color_Tinta" placeholder="Ej: Blanco Hielo" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Sube tus Logos o Bocetos (M√°ximo 5MB por foto / 15MB total)</label>
                        <div class="drop-zone" id="dropZone">
                            <input type="file" id="fileInput" accept="image/*" multiple>
                            <div id="dropContent">
                                <span class="drop-icon">üì∏</span>
                                <p><strong>Pulsa para a√±adir fotos</strong></p>
                                <p style="font-size:0.8rem; opacity:0.6">Se guardan autom√°ticamente al subirlas</p>
                            </div>
                            <div id="fileCounter" class="file-counter">0 archivos listos</div>
                        </div>
                        <div class="preview-grid" id="previewGallery"></div>
                    </div>
                </div>

                <!-- Footer Accion -->
                <div class="section">
                    <label>Instrucciones de locura</label>
                    <textarea name="Mensaje" rows="5" placeholder="¬øNombres en la espalda? ¬øAlg√∫n detalle espec√≠fico? Su√©ltalo aqu√≠..."></textarea>
                    
                    <div class="footer-summary">
                        <span>Prendas totales:</span>
                        <span class="total-amount" id="totalCount">0</span>
                    </div>

                    <button type="submit" class="btn-send" id="submitBtn">Enviar Pedido</button>
                </div>
            </div>
        </form>
    </div>

    <script>
        // CONFIGURACI√ìN DE L√çMITES (Basados en restricciones de FormSubmit y email)
        const MAX_FILE_SIZE = 5 * 1024 * 1024; // 5MB por archivo
        const MAX_TOTAL_SIZE = 15 * 1024 * 1024; // 15MB total del env√≠o
        
        const inputs = document.querySelectorAll('.qty-in');
        const totalDisplay = document.getElementById('totalCount');
        const fileInput = document.getElementById('fileInput');
        const gallery = document.getElementById('previewGallery');
        const counter = document.getElementById('fileCounter');
        const dropZone = document.getElementById('dropZone');
        const submitBtn = document.getElementById('submitBtn');
        const form = document.getElementById('mainForm');

        let selectedFiles = []; // Almac√©n de archivos validados

        // 1. C√°lculo de totales
        function updateTotal() {
            let t = 0;
            inputs.forEach(i => t += (parseInt(i.value) || 0));
            totalDisplay.innerText = t;
        }
        inputs.forEach(i => i.addEventListener('input', updateTotal));

        // 2. Gesti√≥n de archivos con validaci√≥n de tama√±o
        function addFiles(files) {
            let currentTotalSize = selectedFiles.reduce((acc, f) => acc + f.size, 0);

            Array.from(files).forEach(file => {
                // Verificar si es imagen
                if (!file.type.startsWith('image/')) {
                    alert(`El archivo "${file.name}" no es una imagen.`);
                    return;
                }

                // Verificar l√≠mite individual (5MB)
                if (file.size > MAX_FILE_SIZE) {
                    alert(`La imagen "${file.name}" pesa demasiado (${(file.size / (1024 * 1024)).toFixed(2)}MB). El m√°ximo por foto es 5MB.`);
                    return;
                }

                // Verificar l√≠mite total acumulado (15MB)
                if (currentTotalSize + file.size > MAX_TOTAL_SIZE) {
                    alert(`No se pudo a√±adir "${file.name}". Se superar√≠a el l√≠mite total de 15MB para el env√≠o.`);
                    return;
                }

                selectedFiles.push(file);
                currentTotalSize += file.size;
                renderGallery();
            });
            updateCounter();
        }

        function removeFile(index) {
            selectedFiles.splice(index, 1);
            renderGallery();
            updateCounter();
        }

        function renderGallery() {
            gallery.innerHTML = "";
            selectedFiles.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const div = document.createElement('div');
                    div.className = 'preview-item';
                    div.innerHTML = `
                        <button type="button" class="remove-file" onclick="removeFile(${index})">√ó</button>
                        <img src="${e.target.result}" class="preview-img">
                    `;
                    gallery.appendChild(div);
                };
                reader.readAsDataURL(file);
            });
        }

        function updateCounter() {
            const currentTotalMB = (selectedFiles.reduce((acc, f) => acc + f.size, 0) / (1024 * 1024)).toFixed(2);
            counter.innerText = `${selectedFiles.length} archivos (${currentTotalMB}MB / 15MB)`;
            counter.className = selectedFiles.length > 0 ? 'file-counter visible' : 'file-counter';
        }

        // Eventos de Input
        fileInput.addEventListener('change', (e) => {
            addFiles(e.target.files);
            fileInput.value = ""; // Reset para permitir re-subir el mismo archivo si se borr√≥
        });

        // Drag & Drop logic
        dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('dragover'); });
        dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            addFiles(e.dataTransfer.files);
        });

        // 3. Env√≠o del Formulario
        form.addEventListener('submit', async function(e) {
            e.preventDefault(); 

            const totalPrendas = parseInt(totalDisplay.innerText);
            if(totalPrendas <= 0) {
                alert("Otman dice: ¬°A√±ade al menos una prenda para poder fabricarla! üíÄ");
                return;
            }

            submitBtn.innerText = "üöÄ ENVIANDO A PRODUCCI√ìN...";
            submitBtn.disabled = true;

            const formData = new FormData(form);
            
            // Eliminamos el campo 'attachments' por defecto (si lo hubiera) 
            // y a√±adimos los archivos del almac√©n validados
            formData.delete('attachments'); 
            selectedFiles.forEach(file => {
                formData.append('attachment', file); // 'attachment' es el nombre que espera FormSubmit para archivos
            });

            try {
                const response = await fetch(form.action, {
                    method: 'POST',
                    body: formData,
                    headers: { 'Accept': 'application/json' }
                });

                if (response.ok) {
                    alert("¬°Pedido enviado con √©xito! Revisa tu email para la confirmaci√≥n.");
                    location.reload();
                } else {
                    throw new Error("Respuesta del servidor no v√°lida");
                }
            } catch (err) {
                alert("Ha habido un problema al enviar el pedido. Aseg√∫rate de que las fotos no sean extremadamente pesadas.");
                submitBtn.innerText = "Enviar Pedido";
                submitBtn.disabled = false;
            }
        });
    </script>
</body>
</html>
